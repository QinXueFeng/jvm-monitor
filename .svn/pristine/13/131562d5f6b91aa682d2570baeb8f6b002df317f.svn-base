package com.andaily.web.controller;

import com.andaily.domain.dto.log.FrequencyMonitorLogListDto;
import com.andaily.domain.dto.log.ReminderLogListDto;
import com.andaily.service.LogService;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

/**
 * 15-2-13
 *
 * @author Shengzhao Li
 */
@Controller
@RequestMapping("log/")
public class LogController {


    @Autowired
    private LogService logService;


    //监控日志
    @RequestMapping("list.hb")
    public String listLogs(FrequencyMonitorLogListDto listDto, Model model) {
        logService.loadFrequencyMonitorLogListDto(listDto);
        model.addAttribute("listDto", listDto);
        return "log/log_list";
    }


    //提醒日志
    @RequestMapping("reminder_list.hb")
    public String reminderLogs(ReminderLogListDto listDto, Model model) {
        logService.loadReminderLogListDto(listDto);
        model.addAttribute("listDto", listDto);
        return "log/reminder_logs";
    }
    /**
     * 手动执行清理旧的日志, 根据配置的时间
     *
     * @param model Model
     * @return View
     */
    @RequestMapping(value = "execute_clean_log.hb", method = RequestMethod.GET)
    public String executeCleanLog(Model model) {
        final long amount = logService.executeAutoCleanMonitorLogs();
        model.addAttribute("cleaned_amount", amount).addAttribute("alert", "cleanLogOK");
        return "log/log_list";
    }
}
